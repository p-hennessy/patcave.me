<!DOCTYPE html><html lang="en-us"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Game Server Monitoring  - The Patcave</title><meta name="description" content="I was brought on to the TF2Maps.net staff team to bring my technical expertise to help maintain and improve the state of our systems. The first thing I did in order to get an idea of how the servers were used was to install some&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://patcave.me/game-server-monitoring/"><link rel="amphtml" href="https://patcave.me/amp/game-server-monitoring/"><link rel="alternate" type="application/atom+xml" href="https://patcave.me/feed.xml"><link rel="alternate" type="application/json" href="https://patcave.me/feed.json"><link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin><link href="https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700&amp;subset=latin-ext&amp;display=swap" rel="stylesheet"><style>:root{--body-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--heading-font:'Roboto Condensed',sans-serif;--logo-font:'Roboto Condensed',sans-serif;--menu-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"}</style><link rel="stylesheet" href="https://patcave.me/assets/css/style.css?v=f31280b0cec94f98ba48d5f9a90dedef"><link rel="stylesheet" href="https://patcave.me/assets/css/photoswipe.css?v=7331f6eb15671b2fc8e3ffd46e849f7b"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://patcave.me/game-server-monitoring/"},"headline":"Game Server Monitoring ","datePublished":"2021-05-21T13:18","dateModified":"2022-01-28T22:24","image":{"@type":"ImageObject","url":"https://patcave.me/media/posts/9/Screenshot_1.png","height":903,"width":1546},"description":"I was brought on to the TF2Maps.net staff team to bring my technical expertise to help maintain and improve the state of our systems. The first thing I did in order to get an idea of how the servers were used was to install some&hellip;","author":{"@type":"Person","name":"Patrick Hennessy"},"publisher":{"@type":"Organization","name":"Patrick Hennessy"}}</script><style>.pswp--svg .pswp__button,
				          .pswp--svg .pswp__button--arrow--left:before,
				          .pswp--svg .pswp__button--arrow--right:before {
					          background-image: url(https://patcave.me/assets/svg/gallery-icons-light.svg);
			              }</style><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Boogaloo&family=Maven+Pro&display=swap" rel="stylesheet"><link rel="stylesheet" href="https://patcave.me/assets/css/prism.css?v=3b135d1db236b56f00e6b8e7a4af7a98"></head><body><div class="site-container"><header class="top" id="js-header"><a class="logo" href="https://patcave.me/">The Patcave</a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu" aria-haspopup="true" aria-expanded="false"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li><a href="https://patcave.me/" target="_self">Home</a></li><li><a href="https://patcave.me/about/" target="_self">About</a></li><li class="has-submenu"><span class="is-separator" aria-haspopup="true">Contact</span><ul class="navbar__submenu level-2" aria-hidden="true"><li><a href="https://www.linkedin.com/in/pmhennessy/" target="_blank">LinkedIn</a></li><li><a href="https://github.com/ns-phennessy" target="_blank">Github</a></li><li><a href="https://www.youtube.com/channel/UCIw-YA385k1S5IOwYD-iV5Q" target="_blank">YouTube</a></li><li><a href="https://tf2maps.net/members/zeus.28272/" target="_blank">TF2Maps.net</a></li><li><a href="mailto:phennessy517@gmail.com" target="_blank">Email</a></li></ul></li></ul></nav></header><main><article class="post"><div class="hero"><figure class="hero__image hero__image--overlay"><img src="https://patcave.me/media/posts/9/Screenshot_1.png" srcset="https://patcave.me/media/posts/9/responsive/Screenshot_1-xs.png 300w, https://patcave.me/media/posts/9/responsive/Screenshot_1-sm.png 480w, https://patcave.me/media/posts/9/responsive/Screenshot_1-md.png 768w, https://patcave.me/media/posts/9/responsive/Screenshot_1-lg.png 1024w, https://patcave.me/media/posts/9/responsive/Screenshot_1-xl.png 1360w, https://patcave.me/media/posts/9/responsive/Screenshot_1-2xl.png 1600w" sizes="(max-width: 1600px) 100vw, 1600px" loading="eager" height="903" width="1546" alt=""></figure><header class="hero__content"><div class="wrapper"><div class="post__meta"><time datetime="2021-05-21T13:18">May 21, 2021</time></div><h1>Game Server Monitoring </h1></div></header></div><div class="wrapper post__entry"><p>I was brought on to the <a href="https://tf2maps.net/">TF2Maps.net</a> staff team to bring my technical expertise to help maintain and improve the state of our systems. </p><p>The first thing I did in order to get an idea of how the servers were used was to install some monitoring software. </p><hr><h2>Tools that have previously failed me</h2><p>I've had previous experience with a bunch of different tools, but none of them I was really a big fan of, they all have annoying limitations. I've used all of these tools at one point in my career:</p><ul><li><a href="https://www.influxdata.com/time-series-platform/">TICK stack</a></li><li><a href="https://www.nagios.org/">Nagios</a></li><li><a href="https://aws.amazon.com/cloudwatch/">AWS Cloudwatch</a><a href="https://sensu.io/"></a></li><li><a href="https://sensu.io/">Sensu</a></li><li><a href="https://www.sumologic.com/">Sumologic</a></li><li><a href="https://www.elastic.co/what-is/elk-stack">ELK stack</a></li></ul><p>The TICK stack is nice except their dashboarding tool is really lacking in a lot of ways, and their query language is not as nice for more complex use cases. ELK stack has a huge amount of overhead to get it setup well, but a good ELK setup is defiantly really nice. Nagios is just... well... Nagios, not much needs to be said that has been said to death already. Cloudwatch I want to like, but its obviously AWS specific and it's dashboarding is really limited as well. Even pulling metrics from it into Grafana is still really hard to use meaningfully. Infact, as recently as 6 months ago, I tried to do just this but I couldn't find even a documentation page on their query syntax. </p><hr><h2>Enter Prometheus</h2><figure class="post__image post__image--left"><img loading="lazy" src="https://patcave.me/media/posts/9/1200px-Prometheus_software_logo.svg.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://patcave.me/media/posts/9/responsive/1200px-Prometheus_software_logo.svg-xs.png 300w, https://patcave.me/media/posts/9/responsive/1200px-Prometheus_software_logo.svg-sm.png 480w, https://patcave.me/media/posts/9/responsive/1200px-Prometheus_software_logo.svg-md.png 768w, https://patcave.me/media/posts/9/responsive/1200px-Prometheus_software_logo.svg-lg.png 1024w, https://patcave.me/media/posts/9/responsive/1200px-Prometheus_software_logo.svg-xl.png 1360w, https://patcave.me/media/posts/9/responsive/1200px-Prometheus_software_logo.svg-2xl.png 1600w" alt="" width="183" height="181"></figure><p>For the longest time; I was confused at how <a href="https://prometheus.io/">Prometheus</a> worked, and they way they explain its "no long term storage" thing I think turned me off for a long time on it. </p><p>I thought I'd give it a try on the recommendation of a co-worker and it being probably the only tool I haven't yet tried for monitoring.</p><p><a href="https://grafana.com/pricing/">Grafana cloud</a> also has a free tier offering that was enough for me to test stuff out with! </p><p>The storage thing is basically just that they don't retain metrics forever and also don't offer any kind of highly available or redundant storage solution. This is fine for my use case, but may not be suitable for everyone.</p><hr><h2>What to track?</h2><p>So I will be monitoring our 4 <a href="https://wiki.teamfortress.com/wiki/Linux_dedicated_server">Team Fortress 2 game servers</a>. </p><p>Currently they run on <a href="https://en.wikipedia.org/wiki/Colocation_centre">co-located</a> hardware. 2 in New York and 2 in Frankfurt. Each server has its own distinct hostname (DNS resolvable), so I can use that as a "key" to filter by each instance. </p><p>Basically I just want to have some insight to what is going on the server when I'm not directly logged in and so we can analyze historical events like server crashes or moderation events.</p><h5>Instance metrics</h5><ul><li>CPU Metrics</li><li>Memory Use</li><li>Disk Space and IO</li><li>Network IO, packet loss, bandwidth usage</li></ul><h5>Process metrics</h5><ul><li>Is the srcds process even running?</li><li>How long has the srcds process been running</li></ul><h5>Game Server stats</h5><ul><li>Current player count</li><li>Current level server is set to</li><li>Histogram of player activity</li><li>Histogram of levels played</li></ul><hr><h2>How to gather metrics with Prometheus?</h2><p>To my surprise, this is actually quite easy to do, every other tool I've used is very cumbersome to setup. Each of the buckets of metrics I want can be grabbed basically out of the box using <a href="https://prometheus.io/docs/instrumenting/exporters/">Prometheus exporters</a>. Here are the exporters I used:</p><ul><li><a href="https://github.com/prometheus/node_exporter">Node Exporter</a> - Stats about the machine itself.</li><li><a href="https://github.com/ncabatoff/process-exporter">Process Exporter</a> - Stats about specific processes on the machine</li><li><a href="https://github.com/galexrt/srcds_exporter">Srcds Exporter</a> - Specific to srcds data like map name, player count, etc.</li></ul><p>You basically give each one a config file to read a few variables like telling it how to find the process it needs to watch or information about the hostname and most importantly, the Prometheus instance to publish them to. </p><p>Now this is the part that was confusing for me at first. You need to run a local Prometheus on the server in order to publish / replicate the metrics to a remote one that does the actual aggregation. In this case, my local Prometheus published to the one hosted by Grafana Cloud. </p><p>On a small aside, I'll also say the Grafana Cloud docs are fantastic for setting this up and I had absolutely no issues getting going with it.</p><p>Below are snippets from my config files (node_exporter needs no config):</p><pre><span style="text-decoration: underline;"><em><strong>process_exporter.yml<br></strong></em></span><br>---<br>process_names:<br>  - name: "srcds_linux"<br>    exe:<br>    - tmux<br>    cmdline:<br>    - new -d -s tf .*</pre><pre><span style="text-decoration: underline;"><em><strong>srcds_exporter.yml</strong></em></span><br><br>---<br>options:<br>  rcontimeout: 60s<br>  cachetimeout: 15s<br>servers:<br>  us.tf2maps.net:<br>    address: 172.93.228.253:27015<br>    rconpassword: ***password***</pre><hr><h2>Logging Admin Actions</h2><p>TF2 servers often run modding platforms that come with an ecosystem of plugins for doing administrative actions. One very popular platform is called <a href="https://www.sourcemod.net/">SourceMod</a>. Many of the built-in plugins will log important information like administrator actions to a log file that I can parse. Obviously logs are not like metrics that can be measured every minute, log files get new lines at random intervals, so it requires a different tool.</p><p>Thankfully, Prometheus has an answer to this! In order to scrape logs you have to run another service called <a href="https://grafana.com/oss/loki/">Loki</a>, which is advertised as "Prometheus but for logs". Grafana Cloud's free tier also comes with Loki access. Awesome!</p><p>To actually export to Loki, you need to run a Prometheus style exporter called <a href="https://grafana.com/docs/loki/latest/clients/promtail/">Promtail</a>. </p><p>Now, most people who know me know that I'm a wizard with <a href="https://en.wikipedia.org/wiki/Regular_expression">Regular Expressions</a>, though admittedly this one took me a while to get right. Whoever created this log format clearly did not intend for it to be parsed. (Aside: Lea Verou has a great <a href="http://projects.verou.me/regexplained/">RegEx testing tool</a> that I highly recommend for this kind of task.)</p><p>Below is the full config I used to parse the SourceMod log files. (I would have really preferred JSON, but SourceMod has been around since before JSON was a thing)</p><pre>  pipeline_stages:<br>  - match:<br>      selector: '{job="sourcemod"}'<br>      stages:<br>      - regex:<br>          expression: 'L (?P&lt;timestamp&gt;\d{2}\/\d{2}\/\d{4} - \d{2}:\d{2}:\d{2}): \[(?P&lt;plugin&gt;.*\.smx)\] \"(?P&lt;user_name&gt;[A-Za-z0-9\ ]+)&lt;\d+&gt;&lt;(?P&lt;steam_id&gt;\[U:[0-9]:[0-9]+\])&gt;&lt;[\d\w]{0,}&gt;" (?P&lt;message&gt;.*)'<br>      - labels:<br>          plugin:<br>          user_name:<br>          steam_id:<br>      - timestamp:<br>          format: '01/02/2006 - 15:04:05'<br>          source: timestamp<br>      - output:<br>          source: message<br>  - match:<br>      selector: '{job="sourcemod",plugin!~".*.smx"}'<br>      stages:<br>      - drop:<br>          expression: ".*"<br><br>  static_configs:<br>  - labels:<br>      job: sourcemod<br>      __path__: /home/tf/tf/addons/sourcemod/logs/L*.log</pre><p>This basically pulls out the timestamp, plugin name, user name, their steam id, and the actual log message.</p><hr><h2>Configuring Grafana</h2><p>Now that we're collecting these stats, we need to display them! Prometheus does not have a tool for this themselves. The obvious choice here is Grafana, especially because they're very well integrated cloud free tier.</p><p>They have a really nice query builder / explorer to use. Very intuitive, and works well with both Prometheus and Loki out of the box. For most simple queries you can just click a few buttons and get what you want without having to even learn <a href="https://prometheus.io/docs/prometheus/latest/querying/basics/">PromQL</a>.</p><div class="gallery-wrapper"><div class="gallery" data-is-empty="false" data-columns="1"><figure class="gallery__item"><a href="https://patcave.me/media/posts/9/gallery/Screenshot_4.png" data-size="1544x931"><img loading="lazy" src="https://patcave.me/media/posts/9/gallery/Screenshot_4-thumbnail.png" alt="" width="720" height="434"></a></figure></div></div><p>For the actual dashboard panels, I wanted to be able to filter by host. You basically just setup a dashboard variable and then you can use it as a variable in your queries:</p><pre>srcds_playercount_humans{instance=~"$host"}<br>time() - namedprocess_namegroup_oldest_start_time_seconds{instance=~"$host"}</pre><p>Most panels were very easy to setup. Infact most of them were just simple 1 liners just like the queries in the above code.</p><p>The Admin log required 3 transforms to display how I wanted. Filtering out unwanted messages, setting up the table fields, and a labels to fields transform.</p><div class="gallery-wrapper"><div class="gallery" data-is-empty="false" data-columns="3"><figure class="gallery__item"><a href="https://patcave.me/media/posts/9/gallery/Screenshot_6.png" data-size="1193x830"><img loading="lazy" src="https://patcave.me/media/posts/9/gallery/Screenshot_6-thumbnail.png" alt="" width="720" height="501"></a></figure></div></div><p>The panel that gave me the most trouble was the "Map activity" panel.</p><p>It is intended to show the history of the maps played. To get this to work, I had to use the deprecated version of their Graph panel, and setup a transform that converts a Prometheus label to the legend of the graph. If that sounds confusing, that's because it is. I basically monte carlo'd it into working.</p><p> ¯\_(ツ)_/¯</p><div class="gallery-wrapper"><div class="gallery" data-is-empty="false" data-columns="3"><figure class="gallery__item"><a href="https://patcave.me/media/posts/9/gallery/Screenshot_5.png" data-size="451x197"><img loading="lazy" src="https://patcave.me/media/posts/9/gallery/Screenshot_5-thumbnail.png" alt="" width="451" height="197"></a></figure></div></div><hr><h2>Full Dashboard</h2><div class="gallery-wrapper"><div class="gallery" data-is-empty="false" data-columns="1"><figure class="gallery__item"><a href="https://patcave.me/media/posts/9/gallery/Screenshot_1.png" data-size="1546x903"><img loading="lazy" src="https://patcave.me/media/posts/9/gallery/Screenshot_1-thumbnail.png" alt="" width="720" height="421"></a></figure></div></div><p>One thing to mention is that I also have a panel that is tracking the "time in use" stat. This is calculated by time spent running with at least 1 person connected; expressed as a percent. As you can see, we only actually use the servers very little compared to how long they run, and that's a generous number because simply having 1 player on the server doesn't really mean its "in use". This is part of a larger case I'm making for <a href="https://patcave.me/automate-all-the-things/">ad-hoc servers</a>.</p><hr><h2>Takeaways from the data</h2><p>Like I said above, I am tracking a number of stats so I can better determine our hardware needs in the future. Given our budget is extraordinarily low, we need to take as many optimizations as we can get. </p><p>The key takeaways I've gotton from this:</p><ul><li>The server is idle <em>way</em> too much. Ad-hoc servers would solve this problem</li><li>Our bandwidth is higher than I expected<ul><li>Could be optimized by not having to keep a copy of a map on each server, but instead share a file system using something like EFS</li></ul></li><li>We're overprovisioned on CPU, RAM and Disk<ul><li>We never go above 10% cpu use, and we have 2 cores available. A VM with a single core should be more than enough.</li><li>RAM use can get high at times, but that is a function of us running 2 srcds servers on the same VM. We could happily cut the provisioned RAM in half and be fine</li><li>We just don't need a huge disk. We can do a better job of clearing out <code>.dem</code> files (game recordings) and clean out maps after they're been played in our map tests. Disks are fairly cheap though I suppose</li></ul></li></ul><hr><h2>Alerting?</h2><figure class="post__image post__image--left"><img loading="lazy" src="https://patcave.me/media/posts/9/Screenshot_7.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://patcave.me/media/posts/9/responsive/Screenshot_7-xs.png 300w, https://patcave.me/media/posts/9/responsive/Screenshot_7-sm.png 480w, https://patcave.me/media/posts/9/responsive/Screenshot_7-md.png 768w, https://patcave.me/media/posts/9/responsive/Screenshot_7-lg.png 1024w, https://patcave.me/media/posts/9/responsive/Screenshot_7-xl.png 1360w, https://patcave.me/media/posts/9/responsive/Screenshot_7-2xl.png 1600w" alt="" width="315" height="253"></figure><p>Now that I'm tracking this information, can I meaningfully alert off of it?</p><p>Prometheus does have a tool called <a href="https://prometheus.io/docs/alerting/latest/alertmanager/">AlertManager</a> for this task, but I must say this tool is very clunky to use, but even so I was able to get alerts working and publishing to our <a href="https://discord.com/">Discord</a> server.</p><p> </p><p>My big complaint with it is that you have to have a graph that is specific to a metric and setup as an "alarm graph" in order to alarm off of. In other words, I can't use my existing panels because alert manager doesn't like the <code>$host</code> filter. So I have to make a new dashboard just for alerts. </p><p>There is a big lack of customization for the data it shares with Discord and doesn't do a great job of keeping users informed when an alarm clears or is "acked". Also testing the whole alarming setup is really difficult and slow. It does feel like it was designed for a specific team and use case.</p><p>Honestly I'm probably better off using PagerDuty, but I'm not sure how to actually get the data out of Prometheus and into PagerDuty. </p><hr><h2>In summation</h2><p>I have to say that I am pleasantly surprised at how easy this all was to get setup with. Prometheus and Grafana both have done a great job with their documentation and designing their tools for engineers. However their alerting solution could use some work in my opinion. </p><p>I'm happy with this level of success in this small effort because it's a prototype for things I may possibly bring into my work one day. </p><p>There is a synergy in solving problems for TF2Maps. Often at work I don't get as many opportunities as I like to just experiment with new tools. It make sense why we don't just constantly prototype new tools, but in doing so we do sometimes miss valuable setup's like this. </p><p>I would absolutely recommend the Prometheus + Loki + Grafana stack for anyone running game servers, not just Source servers.</p></div><footer class="wrapper post__footer"><ul class="post__tag"><li><a href="https://patcave.me/tags/gaming/">Gaming</a></li><li><a href="https://patcave.me/tags/computer-science/">Programming Stuff</a></li></ul></footer></article><nav class="post__nav"><div class="post__nav-inner"><div class="post__nav-prev"><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://patcave.me/assets/svg/svg-map.svg#arrow-prev"/></svg> <a href="https://patcave.me/procedural-texture-creation/" class="invert post__nav-link" rel="prev"><span>Previous</span> Procedural Texture creation</a></div><div class="post__nav-next"><a href="https://patcave.me/i-am-officially-a-professional-game-designer/" class="invert post__nav-link" rel="next"><span>Next</span> I&#x27;m officially a &quot;professional&quot; game designer! </a><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://patcave.me/assets/svg/svg-map.svg#arrow-next"/></svg></div></div></nav></main><footer class="footer"><div class="footer__copyright"><p>© Patrick Hennessy 2014 - 2022</p></div></footer></div><script>window.publiiThemeMenuConfig = {    
        mobileMenuMode: 'sidebar',
        animationSpeed: 300,
        submenuWidth: 'auto',
        doubleClickTime: 500,
        mobileMenuExpandableSubmenus: true, 
        relatedContainerForOverlayMenuSelector: '.top',
   };</script><script defer="defer" src="https://patcave.me/assets/js/scripts.min.js?v=48e9576b9741cf2a93ab25c5689c9f5d"></script><script>var images = document.querySelectorAll('img[loading]');

        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script><script defer="defer" src="https://patcave.me/assets/js/photoswipe.min.js?v=b586a3bc288c989ecce7b81b48e35855"></script><script defer="defer" src="https://patcave.me/assets/js/photoswipe-ui-default.min.js?v=9952f77ca2b8fbc9449a268008ea8dee"></script><script>var initPhotoSwipeFromDOM=function(gallerySelector){var parseThumbnailElements=function(el){var thumbElements=el.childNodes,numNodes=thumbElements.length,items=[],figureEl,linkEl,size,item;for(var i=0;i<numNodes;i++){figureEl=thumbElements[i];if(figureEl.nodeType!==1){continue;}
          linkEl=figureEl.children[0];size=linkEl.getAttribute('data-size').split('x');item={src:linkEl.getAttribute('href'),w:parseInt(size[0],10),h:parseInt(size[1],10)};if(figureEl.children.length>1){item.title=figureEl.children[1].innerHTML;}
          if(linkEl.children.length>0){item.msrc=linkEl.children[0].getAttribute('src');}
          item.el=figureEl;items.push(item);}
          return items;};var closest=function closest(el,fn){return el&&(fn(el)?el:closest(el.parentNode,fn));};var onThumbnailsClick=function(e){e=e||window.event;e.preventDefault?e.preventDefault():e.returnValue=false;var eTarget=e.target||e.srcElement;var clickedListItem=closest(eTarget,function(el){return(el.tagName&&el.tagName.toUpperCase()==='FIGURE');});if(!clickedListItem){return;}
          var clickedGallery=clickedListItem.parentNode,childNodes=clickedListItem.parentNode.childNodes,numChildNodes=childNodes.length,nodeIndex=0,index;for(var i=0;i<numChildNodes;i++){if(childNodes[i].nodeType!==1){continue;}
          if(childNodes[i]===clickedListItem){index=nodeIndex;break;}
          nodeIndex++;}
          if(index>=0){openPhotoSwipe(index,clickedGallery);}
          return false;};var photoswipeParseHash=function(){var hash=window.location.hash.substring(1),params={};if(hash.length<5){return params;}
          var vars=hash.split('&');for(var i=0;i<vars.length;i++){if(!vars[i]){continue;}
          var pair=vars[i].split('=');if(pair.length<2){continue;}
          params[pair[0]]=pair[1];}
          if(params.gid){params.gid=parseInt(params.gid,10);}
          return params;};var openPhotoSwipe=function(index,galleryElement,disableAnimation,fromURL){var pswpElement=document.querySelectorAll('.pswp')[0],gallery,options,items;items=parseThumbnailElements(galleryElement);options={galleryUID:galleryElement.getAttribute('data-pswp-uid'),getThumbBoundsFn:function(index){var thumbnail=items[index].el.getElementsByTagName('img')[0],pageYScroll=window.pageYOffset||document.documentElement.scrollTop,rect=thumbnail.getBoundingClientRect();return{x:rect.left,y:rect.top+pageYScroll,w:rect.width};},
          mainClass:'pswp--dark',
          preload: [1,2],
          hideAnimationDuration:200,
          showAnimationDuration:0,
          bgOpacity: 0.7,
          showHideOpacity:true,
          closeOnScroll: true,
          arrowKeys: true,
          closeEl: true,
          captionEl: true,
          fullscreenEl: false,
          zoomEl: false,
          shareEl: false,
          counterEl: false,
          arrowEl: true,
          preloaderEl: true
          };if(fromURL){if(options.galleryPIDs){for(var j=0;j<items.length;j++){if(items[j].pid==index){options.index=j;break;}}}else{options.index=parseInt(index,10)-1;}}else{options.index=parseInt(index,10);}
          if(isNaN(options.index)){return;}
          if(disableAnimation){options.showAnimationDuration=0;}
          gallery=new PhotoSwipe(pswpElement,PhotoSwipeUI_Default,items,options);gallery.init();gallery.options.maxSpreadZoom = gallery.getZoomLevel();gallery.options.getDoubleTapZoom = function(isMouseClick, item) {return item.initialZoomLevel;};gallery.options.escKey=true;};var galleryElements=document.querySelectorAll(gallerySelector);for(var i=0,l=galleryElements.length;i<l;i++){galleryElements[i].setAttribute('data-pswp-uid',i+1);galleryElements[i].onclick=onThumbnailsClick;}
          var hashData=photoswipeParseHash();if(hashData.pid&&hashData.gid){openPhotoSwipe(hashData.pid,galleryElements[hashData.gid-1],true,true);}};window.addEventListener('load', function () {initPhotoSwipeFromDOM('.gallery');}, false);</script><div class="pswp" tabindex="-1" role="dialog" aria-hidden="true"><div class="pswp__bg"></div><div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div><div class="pswp__item"></div><div class="pswp__item"></div></div><div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button><button class="pswp__button pswp__button--share" title="Share"></button><button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button><button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button><button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div><script defer="defer" src="https://patcave.me/assets/js/prism.js?v=321a70a7524222ceadba8f8b6815ce1c"></script></body></html>