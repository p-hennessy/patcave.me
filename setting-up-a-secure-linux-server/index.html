<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Setting up a secure Linux Server - The Patcave</title><meta name="description" content="This is not a comprehensive guide; but should get you started and prevent you from getting pwned immediately. Following these small steps will make you a much harder target to compromise, and are probably not worth most hackers time. There are a lot of automated&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://patcave.me/setting-up-a-secure-linux-server/"><link rel="amphtml" href="https://patcave.me/amp/setting-up-a-secure-linux-server/"><link rel="alternate" type="application/atom+xml" href="https://patcave.me/feed.xml"><link rel="alternate" type="application/json" href="https://patcave.me/feed.json"><link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin><link href="https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700&amp;subset=latin-ext&amp;display=swap" rel="stylesheet"><style>:root{--body-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--heading-font:'Roboto Condensed',sans-serif;--logo-font:'Roboto Condensed',sans-serif;--menu-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"}</style><link rel="stylesheet" href="https://patcave.me/assets/css/style.css?v=5e135d0d210272b76282b2f4b2f5f32a"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://patcave.me/setting-up-a-secure-linux-server/"},"headline":"Setting up a secure Linux Server","datePublished":"2014-05-02T15:15","dateModified":"2022-01-25T21:57","description":"This is not a comprehensive guide; but should get you started and prevent you from getting pwned immediately. Following these small steps will make you a much harder target to compromise, and are probably not worth most hackers time. There are a lot of automated&hellip;","author":{"@type":"Person","name":"Patrick Hennessy"},"publisher":{"@type":"Organization","name":"Patrick Hennessy"}}</script><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Boogaloo&family=Maven+Pro&display=swap" rel="stylesheet"></head><body><div class="site-container"><header class="top" id="js-header"><a class="logo" href="https://patcave.me/">The Patcave</a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu" aria-haspopup="true" aria-expanded="false"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li><a href="https://patcave.me/" target="_self">Home</a></li><li><a href="https://patcave.me/about/" target="_self">About</a></li><li class="has-submenu"><span class="is-separator" aria-haspopup="true">Contact</span><ul class="navbar__submenu level-2" aria-hidden="true"><li><a href="https://www.youtube.com/channel/UCIw-YA385k1S5IOwYD-iV5Q" target="_blank">YouTube</a></li><li><a href="https://www.linkedin.com/in/pmhennessy/" target="_blank">LinkedIn</a></li><li><a href="https://github.com/ns-phennessy" target="_blank">Github</a></li><li><a href="https://tf2maps.net/members/zeus3005.28272/" target="_self">TF2Maps.net</a></li></ul></li></ul></nav></header><main><article class="post"><div class="hero"><header class="hero__content"><div class="wrapper"><div class="post__meta"><time datetime="2014-05-02T15:15">May 2, 2014</time></div><h1>Setting up a secure Linux Server</h1></div></header></div><div class="wrapper post__entry"><p dir="auto">This is not a comprehensive guide; but should get you started and prevent you from getting pwned immediately.</p><p dir="auto">Following these small steps will make you a much harder target to compromise, and are probably not worth most hackers time.</p><p dir="auto">There are a lot of automated attacks going around and hitting known server cluster IP ranges looking for low hanging fruit and vulnerable servers they can exploit.</p><hr><h2 dir="auto">Creating a Droplet</h2><p dir="auto">DigitalOcean makes it very simple to create a droplet. Once you have an account, create a droplet</p><ul dir="auto"><li><strong>Name</strong>: Name your droplet whatever you want. This will become the <strong>hostname</strong> on the machine itself once it's created.</li><li><strong>Size</strong>: Go for the cheapest one. The most it will charge you is $5 / month (a very good deal imo).</li><li><strong>Location</strong>: I've found that the New York location is rather slow for me, so I usually opt for the San Francisco location.</li><li><strong>Image</strong>: Most people will be comfortable with Ubuntu; so we will select that.</li></ul><p dir="auto">Also important to note; you should opt for using <a href="https://wiki.ubuntu.com/LTS" rel="nofollow">LTS</a> releases since they're supported for a while.</p><hr><h2 dir="auto">Login</h2><p dir="auto">Once created; DigitalOcean will e-mail you your new login credentials.</p><h3 dir="auto">From a Terminal (OSX or Linux)</h3><p dir="auto">Open a terminal window and type in the following command:</p><div class="highlight highlight-source-shell position-relative overflow-auto"><pre>ssh root@ipaddress</pre></div><p dir="auto">It will prompt for a password; enter the one sent to your email.</p><h3 dir="auto">From Putty (Windows)</h3><p dir="auto">Download <a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html" rel="nofollow">PuTTy</a> if you don't have it already. PuTTy will simulate a terminal session similar to that on a Linux or OSX system.</p><p dir="auto">Put in the supplied ip-address in the <code>hostname</code> field, and leave the port on <code>22</code>. Then click connect.</p><p dir="auto">You will be prompted for your password; feel free to copy and paste it from the email directly. If you did everything right; you should now be logged into your DigitalOcean node as the root user!</p><hr><h2 dir="auto">Installing Updates</h2><p dir="auto">The first thing you should do is bring all your software up to date.</p><p dir="auto">DigitalOcean does pretty well keeping their images up to date; but you want to get in the habit of having the freshest updates to software on your system.</p><p dir="auto">Use the following commands:</p><div class="highlight highlight-source-shell position-relative overflow-auto"><pre>apt-get update
apt-get upgrade</pre></div><p dir="auto"><strong>update</strong> will hit all the <a href="https://help.ubuntu.com/community/Repositories/Ubuntu" rel="nofollow">Ubuntu repositories</a> and refresh any package names or versions.</p><p dir="auto"><strong>upgrade</strong> will upgrade any out of date packages and remove anything that is now unnecessary on your system.</p><hr><h2 dir="auto">Disabling Root Access</h2><p dir="auto">It's a good idea to disable root user logins via SSH. Root is allowed to do literally anything on a system, so it's a dangerous account.</p><hr><h2 dir="auto">Add an admin (sudo) account</h2><p dir="auto">A <strong>sudo</strong> user is a user on a Linux system who as the ability to perform certain root-level operations after a password prompt. <em>You should only give <code>sudo</code> access to users who absolutely need it.</em></p><p dir="auto">Use the following command to add a new sudoer:</p><div class="highlight highlight-source-shell position-relative overflow-auto"><pre>useradd -g sudo -s /bin/bash pat</pre></div><p dir="auto">It will prompt you for a password and email; put whatever you like there (it can be changed later if desired).</p><p dir="auto">Once done; I would <em><strong>highly</strong></em> recommend starting another terminal or PuTTy session and logging in as this user to verify that you're able to login. The last thing you want is to lock yourself out.</p><h3 dir="auto">Disable Root Login over SSH</h3><p dir="auto">Next you'll need to stop the root user from logging in at all.</p><div class="highlight highlight-source-shell position-relative overflow-auto"><pre>vim /etc/ssh/sshd_config</pre></div><p dir="auto">Look for a line that says <code>PermitRootLogin</code> and set it to <code>no</code></p><p dir="auto">Then reset the SSH server:</p><div class="highlight highlight-source-shell position-relative overflow-auto"><pre>systemctl restart sshd</pre></div><hr><h2 dir="auto">Firewall</h2><p dir="auto">Another important thing to do is to stop automated port scanning attacks on your server. At the moment, we are only using a single port for our communications, <em>22</em> for SSH. A <a href="http://en.wikipedia.org/wiki/Firewall_%28computing%29" rel="nofollow">firewall</a> can stop other hosts from connecting to those ports, hogging up system resources, and potentially exploiting unknown vulnerabilities.</p><p dir="auto">You should tune the rules to your liking, but heres a good <a href="https://gist.github.com/ns-phennessy/5a3b60e41022748f5f68">boilerplate</a> to start from</p><div class="highlight highlight-source-shell position-relative overflow-auto"><pre>wget https://gist.githubusercontent.com/ns-phennessy/5a3b60e41022748f5f68/raw/e9e96a793dd5668b8568a437e083594318a41c86/Firewall%20Script
chmod +x Firewall<span class="pl-cce">\ </span>Script
sudo bash Firewall<span class="pl-cce">\ </span>Script</pre></div><p dir="auto">The script will setup sensible defaults and leave port 22 open. <strong>IT IS VERY IMPORTANT TO NEVER CLOSE PORT 22</strong>. You <em>will</em> lock yourself out of your system if you do this.</p><hr><h2 dir="auto">Fail2Ban</h2><p dir="auto"><a href="http://en.wikipedia.org/wiki/Fail2ban" rel="nofollow">Fail2Ban</a> is a <a href="http://en.wikipedia.org/wiki/Daemon_%28computing%29" rel="nofollow">daemon</a> that follows the authentication log and see if any IP address has too many failed login attempts, and temporarily bans them.</p><p dir="auto">Install it and setup default config:</p><div class="highlight highlight-source-shell position-relative overflow-auto"><pre>sudo apt-get install fail2ban
sudo cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.local</pre></div><p dir="auto">You can now go and tweak your jail settings.</p><div class="highlight highlight-source-shell position-relative overflow-auto"><pre>sudo vim /etc/fail2ban/jail.local</pre></div><p dir="auto">I like to set my <code>bantime</code> ridiculously high but give myself a <code>maxretry</code> of at least 5 over a <code>findtime</code> of about 10 minutes.</p><p dir="auto">Remember that the goal is to catch brute force attacks, you need to be aware that your rules will have to reflect the kind of traffic you're seeing. A smart attacker will brute force your system slowly to avoid getting caught up in filters like this one.</p><hr><h2 dir="auto">Done!</h2><p dir="auto">Congrats, you're setup and had your first taste with server security. Hopefully this article has given you some insight into how to setup and maintain a Linux server and not get immediately hacked</p></div><footer class="wrapper post__footer"><ul class="post__tag"><li><a href="https://patcave.me/tags/computer-science/">Programming Stuff</a></li></ul></footer></article><nav class="post__nav"><div class="post__nav-inner"><div class="post__nav-next"><a href="https://patcave.me/graduation/" class="invert post__nav-link" rel="next"><span>Next</span> Graduation! </a><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://patcave.me/assets/svg/svg-map.svg#arrow-next"/></svg></div></div></nav></main><footer class="footer"><div class="footer__copyright"><p>© Patrick Hennessy 2015 - 2022</p></div></footer></div><script>window.publiiThemeMenuConfig = {    
        mobileMenuMode: 'sidebar',
        animationSpeed: 300,
        submenuWidth: 'auto',
        doubleClickTime: 500,
        mobileMenuExpandableSubmenus: true, 
        relatedContainerForOverlayMenuSelector: '.top',
   };</script><script defer="defer" src="https://patcave.me/assets/js/scripts.min.js?v=48e9576b9741cf2a93ab25c5689c9f5d"></script><script>var images = document.querySelectorAll('img[loading]');

        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script></body></html>